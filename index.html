<!doctype html>
<html lang="en">
<head>
  <title> FDM.NRW Werkstatt </title>
  <meta name="description" content=" incf-2022-lightning-jsheunis ">
  <meta name="author" content=" Stephan Heunis ">

  <meta charset="utf-8">
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="reveal.js/dist/reset.css">
  <link rel="stylesheet" href="reveal.js/dist/reveal.css">
  <link rel="stylesheet" href="reveal.js/dist/theme/beige.css">
  <!-- Theme used for syntax highlighted code -->
  <link rel="stylesheet" href="reveal.js/plugin/highlight/monokai.css">
  <link rel="stylesheet" href="custom_styles.css">
</head>
<body>

<div class="reveal">
<div class="slides">

<!-- FRONT PAGE -->
<section>
    <h2 style="margin-bottom: 0;">FDM.NRW Werkstatt 2023</h2>
    <img src="pics/datalad_git.svg" style="height:300px; margin-bottom: 0;" alt="title image">
    <div style="margin-top:0.5em;">
        <table style="border: none;">
            <tr>
                <td>Michael Hanke<br>Adina Wagner<br>Stephan Heunis
                </td>
                <td style="text-align: center;">
                    <img style="height:100px;margin-right:1px;margin-bottom:20px;margin-top: 1.5em; vertical-align:middle;" data-src="pics/fzj_logo.svg" />
                    <br>
                    <small>
                        <a href="https://fosstodon.org/@datalad" target="_blank">
                        <img data-src="pics/mastodon.svg" style="height:30px;margin:0px" />
                        @datalad
                        </a>
                    </small>
                    <small>
                        <a href="https://github.com/datalad" target="_blank">
                        <img data-src="pics/GitHub.png" style="height:30px;margin:0px" />
                        datalad
                        </a>
                    </small>
                </td>
            </tr>
        </table>
    </div>
    <p style="text-align: center;">
        <small><a href="http://psychoinformatics.de" target="_blank">Psychoinformatics lab</a>
            <br>
            Institute of Neuroscience and Medicine, Brain &amp; Behavior (INM-7), Germany
            <br>
        </small>
    </p>
    <br>
    <div>
        <small>Slides:&nbsp;</small><a href="https://psychoinformatics-de.github.io/fdm-datalad"><small>psychoinformatics-de.github.io/fdm-datalad</small></a>
    </div>
</section>


<section>
    <h2>Acknowledgements</h2>

    <div style="margin-top:0.5em;">
        <table style="border: none;">
            <tr>
                <td><img style="height:500px;margin-right:1px;margin-bottom:10px;vertical-align:middle;" data-src="pics/funders.svg" /></td>
                <td><img style="height:500px;margin-right:1px;margin-bottom:10px;vertical-align:middle;border:1px solid black" data-src="pics/psyinf_team.png" /></td>
            </tr>
        </table>
    </div>
</section>


<section>
    <h2>Agenda</h2>
    <br>
    <ol>
        <li>Talk: Using DataLad to interface RDM infrastructures</li>
        <li>Code-along demo: Publishing datasets</li>
    </ol>
</section>

<section>
<section>
    <h2><code>1</code></h2>
    <h2><code>Using DataLad to interface RDM infrastructures</code></h2>
</section>

</section>

<section>
<section>
    <h2><code>2</code></h2>
    <h2><code>Code-along demonstration</code></h2>
</section>

<section>
    <h2>Practical aspects</h2>
    <img width="200" src="pics/jupyter_logo.png" alt="jupyterlogo"><br>
    <ul>
        <li>We'll work in the browser on a cloud server with JupyterHub</li>
        <li class="fragment">Cloud-computing environment:<br>
            &nbsp;&nbsp;&nbsp;- <a href="https://datalad-hub.inm7.de">datalad-hub.inm7.de</a>
        </li>
        <li class="fragment">We have pre-installed DataLad and other requirements</li>
        <li class="fragment">We will work via the terminal</li>
        <li class="fragment">Draw a username, and set a password of your choice when logging in for the first time; remember it!</li>
    </ul>
</section>


<section style="text-align: left;">
    <h3>Using DataLad in the Terminal</h3>

    Check the installed version:
    <pre style="margin-left: 0;">
        <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
            datalad --version
        </code>
        <p id="displayArea"></p>
    </pre>

    <div class="fragment">
        For help on using DataLad from the command line:
        <pre style="margin-left: 0;">
            <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                datalad --help
            </code>
        </pre>
    </div>

    <div class="fragment">
        For extensive info about the installed package, its dependencies, and extensions, use <code>wtf</code>:
        <pre style="margin-left: 0;">
            <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                datalad wtf
            </code>
        </pre>
    </div>
</section>


<section style="text-align: left;">
    <h3>git identity</h3>
    Check git identity:
    <pre style="margin-left: 0;">
        <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
            git config --get user.name
            git config --get user.email
        </code>
    </pre>

    <div class="fragment">
        Configure git identity:
        <pre style="margin-left: 0;">
            <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                git config --global user.name "Stephan Heunis"
                git config --global user.email "s.heunis@fz-juelich.de"
            </code>
        </pre>
    </div>
</section>


<section style="text-align: left;">
    <h3>Using datalad via its Python API</h3>
    Open a Python environment:
    <pre style="margin-left: 0;">
        <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
            ipython
        </code>
    </pre>
    <div class="fragment">
        Import and start using:
        <pre style="margin-left: 0;">
            <code data-trim class="language-python" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                import datalad.api as dl
                dl.create(path='mydataset')
            </code>
        </pre>
    </div>
    <div class="fragment">
        Exit the Python environment:
        <pre style="margin-left: 0;">
            <code data-trim class="language-python" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                exit
            </code>
        </pre>
    </div>
</section>
</section>

<!-- PUBLISHING: THEORY -->


<section>
  <section data-transition="None">
      <h2>Quick Basics</h2>
    <img src="pics/dataset.svg" width="600"> <br>
  </section>

  <section data-transition="None">
      <h2>Quick Basics</h2>
    <img src="pics/publishing_gitvsannex.svg" width="900"> <br>
  </section>

  <section data-transition="None">
      <h2>Quick Basics</h2>
    <img src="pics/local_wf.svg" width="600"> <br>
  </section>

  <section data-transition="None">
      <h2>Quick Basics</h2>
    <img src="pics/researchlog.png" width="900"> <br>
  </section>

  <section data-transition="None">
      <h2>Quick Basics</h2>
    <img src="pics/reproducible_execution.svg" width="900"> <br>
  </section>


<section style="text-align: left;">
    <h2>Our dataset: Midterm YODA Data Analysis Project</h2>
    <ul style="font-size: xx-large">
        <li>DataLad dataset: <a href="https://github.com/datalad-handbook/midterm_project">https://github.com/datalad-handbook/midterm_project</a></li>
        <li>Find out more: <a href="https://handbook.datalad.org/en/latest/basics/101-126-intro.html">A Data Analysis Project with DataLad</a></li>
        <li>All inputs (i.e. building blocks from other sources) are located in the <code>input/</code> subdataset</li>
        <li>Custom code is located in <code>code/</code></li>
        <li>Relevant software is included as a software container</li>
        <li>Outcomes are generated with a provenance tracked run command, and located in the root of the dataset:</li>
        <ul>
            <li><code>prediction_report.csv</code> contains the main classification metrics</li>
            <li><code>output/pairwise_relationships.png</code> is a plot of the relations between features.</li>
        </ul>
    </ul>
    <pre style="margin-left: 0; margin-top: 2em;">
        <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
            [DS~0] ~/midterm_project
            ├── CHANGELOG.md
            ├── README.md
            ├── code/
            │   ├── README.md
            │   └── script.py
            ├── [DS~1] input/
            │   └── iris.csv -> .git/annex/objects/...
            ├── pairwise_relationships.png -> .git/annex/objects/...
            └── prediction_report.csv -> .git/annex/objects/...
        </code>
    </pre>
</section>

<section style="text-align: left;">
    <h2>Our dataset: Midterm YODA Data Analysis Project</h2>
        <ul>
    <li>Let's explore the dataset briefly</li>
        </ul>
    <div class="fragment">
    Install the dataset:
        <pre style="margin-left: 0; margin-top: 2em;">
        <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
            datalad clone \
            https://github.com/datalad-handbook/midterm_project.git
        </code>
        </pre>
    </div> <div class="fragment">
    Find out about its subdatasets
        <pre style="margin-left: 0; margin-top: 2em;">
        <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
            cd midterm_project
            datalad subdatasets
        </code>
        </pre>
    </div> <div class="fragment">
    Get some contents
        <pre style="margin-left: 0; margin-top: 2em;">
        <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
            datalad get input
        </code>
        </pre>
    </div> <div class="fragment">
    Drop some contents
        <pre style="margin-left: 0; margin-top: 2em;">
        <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
            datalad drop input
        </code>
        </pre>
    </div> <div class="fragment">
    Find out about its history
    <pre style="margin-left: 0; margin-top: 2em;">
        <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
            tig
        </code>
        </pre>
    </div> <div class="fragment">
    Reproduce an analysis
    <pre style="margin-left: 0; margin-top: 2em;">
        <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
            datalad rerun HEAD~2
        </code>
        </pre>
</section>
</section>

<section>
    <section>
    <h2>Our plan</h2>
    <br>
    <ol>
        <li><strong>Learn</strong> - How do we publish data?</li>
        <li><strong>Do</strong> - Publish data to:</li>
        <ul>
            <li>GitLab</li>
            <li>OSF</li>
            <li>Sciebo (webdav)</li>
            <li>Dataverse</li>
        </ul>
    </ol>
</section>

  <section data-transition="None">
      <h2>"Share data like source code"</h2>
      <ul style="font-size:30px">
          <li class="fragment fade-in-then-semi-out" data-fragment-index="1">Datasets can be cloned, pushed, and updated from and to <strong>local</strong> and <strong>remote</strong></strong> paths,
              remote <strong>hosting services</strong>, external <strong>special remotes</strong></li>
      <img class="fragment fade-in" data-fragment-index="1" style="box-shadow: 5px 5px 3px #888888"  height="330" src="pics/collaboration.svg">
          <li class="fragment fade-in">Examples: <br>
          Local path <pre><code>../my-projects/experiment_data</code></pre>
          Remote path <pre><code>myuser@myinstitutes.hcp.system:/home/myuser/my-projects/experiment_data</code></pre>
          Hosting service <pre><code>git.github.com:myuser/experiment_data.git</code></pre>
          External special remotes <pre><code>osf://my-osf-project-id</code></pre></li>
      </ul>
  <aside class="notes">
  Idea behind datalad: Enable a similar level of tooling and culture for the distribution and version control of data as it is present for open source software development
  </aside>
  </section>


  <section data-transition="None">
      <h2>Interoperability</h2>
      <ul style="font-size:30px">
          <li>DataLad is built to maximize interoperability and use with hosting and
              storage technology</li>
          </ul>
      <img src="pics/services_only.png" height="650">
            <small>See the chapter <a href="http://handbook.datalad.org/en/latest/basics/basics-thirdparty.html" target="_blank">
          Third party infrastructure</a> for walk-throughs for different services</small>
  </section>

  <section data-transition="None">
      <h2>Interoperability</h2>
      <ul style="font-size:30px">
          <li>DataLad is built to maximize interoperability and use with hosting and
              storage technology</li>
      </ul>
      <img src="pics/services_connected.png" height="650">
      <small>See the chapter <a href="http://handbook.datalad.org/en/latest/basics/basics-thirdparty.html" target="_blank">
          Third party infrastructure</a> for walk-throughs for different services</small>
  </section>


  <section data-transition="None">
      <h2>Publishing datasets</h2>
      I have a dataset on my computer. How can I share it, or collaborate on it?
      <img height="900" src="pics/startingpoint.svg">
  </section>

  <section data-transition="None">
      <h2>Glossary</h2>
      <dl style="font-size:30px">
          <dt class="fragment fade-in" data-fragment-index="1">
              Sibling (remote)</dt>
          <dd class="fragment fade-in" data-fragment-index="1">
              Linked clones of a dataset. You can usually update (from) siblings to keep all your siblings in sync
              (e.g., ongoing data acquisition stored on experiment compute and backed up on cluster and external hard-drive)
          </dd>
          <dt class="fragment fade-in" data-fragment-index="2">
              Repository hosting service</dt>
          <dd class="fragment fade-in" data-fragment-index="2">
              Webservices to host Git repositories, such as GitHub, GitLab, Bitbucket, Gin, ...</dd>
          <dt class="fragment fade-in" data-fragment-index="3">
              Third-party storage</dt>
          <dd class="fragment fade-in" data-fragment-index="3">
              Infrastructure (private/commercial/free/...) that can host data. A "special remote" protocol
              is used to publish or pull data to and from it
          </dd>
          <dt class="fragment fade-in" data-fragment-index="4">
              Publishing datasets</dt>
          <dd class="fragment fade-in" data-fragment-index="4">
              <em>Pushing</em> dataset contents (Git and/or annex) to a sibling using <strong>datalad push</strong></dd>
          <dt class="fragment fade-in" data-fragment-index="5">
              Updating datasets</dt>
          <dd class="fragment fade-in" data-fragment-index="5">
              <em>Pulling</em> new changes from a sibling using <strong>datalad update --merge</strong></dd>
      </dl>
  </section>

  <section data-transition="None">
      <h2>Publishing datasets</h2>
      <ul>
          <li>Most public datasets separate content in Git versus git-annex behind the scenes</li>
      </ul>
      <img height="900" src="pics/publishing_network_gitvsannex.svg">

  </section>

  <section data-transition="None">
      <h2>Publishing datasets</h2>
      <img height="900" src="pics/publishing_network_publishparts.svg">
  </section>

  <section data-transition="None">
      <h2>Publishing datasets</h2>
      <img height="900" src="pics/publishing_network_publishparts2.svg">
  </section>

  <section data-transition="None">
      <h2>Publishing datasets</h2>
      Typical case:
      <ul style="font-size:30px">
          <li class="fragment fade-in">
              Datasets are exposed via a private or public repository on a
              repository hosting service
          </li>
          <li class="fragment fade-in">
              Data can't be stored in the repository hosting service, but can be
              kept in almost any third party storage
          </li>
          <li class="fragment fade-in">
              Publication dependencies automate pushing to the correct place, e.g.,
              <pre>
                <code class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
$ git config --local remote.github.datalad-publish-depends gdrive
# or
$ datalad siblings add --name origin --url git@git.jugit.fzj.de:adswa/experiment-data.git --publish-depends s3
            </code>
            </pre>
        </li>
      </ul>
      <img src="pics/publishing_network_publishdepends.svg">
  </section>


  <section data-transition="None">
      <h2>Publishing datasets</h2>
            <p style="font-size:30px"> Special case 1: repositories with annex support</p>
      <img height="850" class="fragment fade-in" src="pics/publishing/publishing_network_publishgin.svg">
  </section>

  <section data-transition="None">
      <h2>Publishing datasets</h2>
      <p style="font-size:30px">Special case 2: Special remotes with repositories</p>
      <img height="850" src="pics/publishing/publishing_network_publishosf.svg">
  </section>
</section>




<!-- PUBLISHING: CODE ALONG -->

<section>
<section>
    <h2><code>2a</code></h2>
    <h2><code>Publishing to GitLab</code></h2>
    <p><a href="https://gitlab.com/">https://gitlab.com/</a></p>
    <img src="pics/gitlab-logo-100.svg" alt="gitlab-logo">
</section>

<section style="text-align: left;">
    <div style="display: flex !important; align-items: center">
        <h2>create-sibling-gitlab</h2>&nbsp;<a href="https://handbook.datalad.org/en/latest/basics/101-139-hostingservices.html#creating-a-sibling-on-gitlab">(docs)</a>
    </div>

    <ol>
        <li class="fragment">Log into GitLab</li>
        <li class="fragment">Create personal access token</li>
        <li class="fragment">Create a top-level group</li>
        <li class="fragment">Create a gitlab config file (replace relevant items)</li>
    </ol>
    <div class="fragment">
        <pre style="margin-left: 0;">
            <code data-noescape data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                cat << EOF > ~/.python-gitlab.cfg
                [my-site]
                url = https://gitlab.com/
                private_token = my-gitlab-token
                api_version = 4
                EOF
            </code>
        </pre>
    </div>
    <div class="fragment">
        5. Configure <code>create-sibling-gitlab</code> in the <code>midterm_project</code> dataset:
        <pre style="margin-left: 0;">
            <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                datalad configuration set datalad.gitlab-default-site='my-site'
                datalad configuration set datalad.gitlab-'my-site'-project='my-top-level-group'
            </code>
        </pre>
    </div>
    <div class="fragment">
        6. Create the sibling:
        <pre style="margin-left: 0;">
            <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                datalad create-sibling-gitlab -d . --recursive -s 'my-gitlab-sibling'
            </code>
        </pre>
    </div>
    <div class="fragment">
        7. Push to the sibling:
        <pre style="margin-left: 0;">
            <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                datalad push -d . --recursive --to 'my-gitlab-sibling'
            </code>
        </pre>
    </div>
</section>
</section>



<section>
<section>
    <h2><code>Publishing to OSF</code></h2>
    <p><a href="https://osf.io/">https://osf.io/</a></p>
    <img src="pics/git-annex-osf-logo.png" alt="datalad-osf-logo" width="50%">
</section>

<section style="text-align: left;">
    <div style="display: flex !important; align-items: center">
        <h2>create-sibling-osf</h2>&nbsp;<a href="https://docs.datalad.org/projects/osf/en/latest/">(docs)</a>
    </div>
    
    <ol>
        <li class="fragment">Log into OSF</li>
        <li class="fragment">Create personal access token</li>
        <li class="fragment">Enter credentials using <code>datalad osf-credentials</code>:</li>
    </ol>
    <div class="fragment">
        <pre style="margin-left: 0;">
            <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                datalad osf-credentials
            </code>
        </pre>
    </div>
    <div class="fragment">
        4. Create the sibling:
        <pre style="margin-left: 0;">
            <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                datalad create-sibling-osf -d . -s 'my-osf-sibling' \
                --title 'my-osf-project-title' --mode export --public
            </code>
        </pre>
    </div>
    <div class="fragment">
        5. Push to the sibling:
        <pre style="margin-left: 0;">
            <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                datalad push -d . --recursive --to 'my-osf-sibling'
            </code>
        </pre>
    </div>
    <div class="fragment">
        6. Clone from the sibling:
        <pre style="margin-left: 0;">
            <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                datalad clone osf://'my-osf-project-id'/
            </code>
        </pre>
    </div>
</section>
</section>


<section>
<section>
    <h2><code>Publishing to Sciebo</code></h2>
    <p><a href="https://hochschulcloud.nrw/en/">https://hochschulcloud.nrw/en/</a></p>
    <img src="pics/Sciebo_Logo.svg" alt="sciebo-logo">
</section>

<section style="text-align: left;">
    <div style="display: flex !important; align-items: center">
        <h2>create-sibling-webdav</h2>&nbsp;<a href="https://docs.datalad.org/projects/next/en/latest/generated/man/datalad-create-sibling-webdav.html">(docs)</a>
    </div>

    <ol>
        <li class="fragment">Log into Sciebo</li>
        <li class="fragment">Copy your WebDAV URL: Menu &gt; Files &gt; Settings &gt; WebDAV <br>
            <small>E.g.: <code>https://fz-juelich.sciebo.de/remote.php/dav/files/s.heunis%40fz-juelich.de/</code></small>
        </li>
        <li class="fragment">Create the sibling:</li>
    </ol>
    <div class="fragment">
        <pre style="margin-left: 0;">
            <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                datalad create-sibling-webdav -d . -r -s 'my-webdav-sibling' \
                --mode filetree 'my-webdav-url'
            </code>
        </pre>
        At this point, DataLad should ask for credentials if you have not entered them before. Enter your Sciebo username and password.
    </div>
    <div class="fragment">
        4. Push to the sibling:
        <pre style="margin-left: 0;">
            <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                datalad push -d . --recursive --to 'my-webdav-sibling'
            </code>
        </pre>
    </div>
    <div class="fragment">
        5. Clone from the sibling:
        <pre style="margin-left: 0;">
            <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                datalad clone "datalad-annex::?type=webdav&encryption=none\
                &exporttree=yes&url='my-webdav-url'/'dataset-name'"
            </code>
        </pre>
    </div>
</section>
</section>



<section>
<section>
    <h2><code>Publishing to Dataverse</code></h2>
    <p><a href="https://dataverse.org/">https://dataverse.org/</a></p>
    <table>
        <tr>
            <td style="width: 50%;"><img src="pics/dataverse_r_project.png" alt=""></td>
            <td><img src="pics/dataladdataverse.png" alt="dataladdataverse-logo"></td>
        </tr>
    </table>
</section>

<section style="text-align: left;">
    <div style="display: flex !important; align-items: center">
        <h2>add-sibling-dataverse</h2>&nbsp;<a href="https://docs.datalad.org/projects/dataverse/en/latest/">(docs)</a>
    </div>
    <ol>
        <li class="fragment">Create an account and log into demo.dataverse.org (or your instance)</li>
        <li class="fragment">Create and copy a new API token</li>
        <li class="fragment">Create a new Dataverse dataset</li>
        <li class="fragment">Add required metadata and save dataset</li>
        <li class="fragment">Retieve dataset DOI and the Dataverse instance URL</li>
        <li class="fragment">Create the sibling:</li>
    </ol>
    <div class="fragment">
        <pre style="margin-left: 0;">
            <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                datalad add-sibling-dataverse -d . -s 'my-dataverse-sibling' \
                'my-dataverse-instance-url' doi:'my-dataset-doi'
            </code>
        </pre>
        <em>for example:</em>
        <pre style="margin-left: 0;">
            <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                datalad add-sibling-dataverse -d . -s dataverse \
                https://demo.dataverse.org  doi:10.70122/FK2/3K9FOD
            </code>
        </pre>
        <em>At this point, DataLad should ask for credentials if you have not entered them before. Enter the API token that you created earlier.</em>
    </div>
    <div class="fragment">
        7. Push to the sibling:
        <pre style="margin-left: 0;">
            <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                datalad push -d . --to 'my-dataverse-sibling'
            </code>
        </pre>
    </div>
    <div class="fragment">
        8. Clone from the sibling:
        <pre style="margin-left: 0;">
            <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                datalad clone 'datalad-annex::?type=external&externaltype=dataverse\
                &encryption=none&exporttree=no&url='my-dataverse-instance-url'\
                &doi='my-dataset-doi' midterm_project
            </code>
        </pre>
    </div>
</section>
</section>




<section>
    
</section>

<section>
    <h2><code>Extra</code></h2>
</section>

<section>
    <h2><code>Datalad Basics</code></h2>
</section>

<section>
    <h3 style="text-align: left;">Datalad datasets...</h3>
    <img src="pics/comic_box4.svg" alt="">
</section>


<section style="text-align: left;">
    <h3>...Datalad datasets</h3>
    Create a dataset (here, with the <code>text2git</code> config):
    <pre style="margin-left: 0;">
        <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
            datalad create -c text2git bids-data
        </code>
    </pre>

    <div class="fragment">
        Let's have a look inside. Navigate using <code>cd</code> (change directory):
        <pre style="margin-left: 0;">
            <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                cd bids-data
            </code>
        </pre>
    </div>

    <div class="fragment">
        List the directory content, including hidden files, with <code>ls</code>:
        <pre style="margin-left: 0;">
            <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                ls -la .
            </code>
        </pre>
    </div>
</section>


<section>
    <h3 style="text-align: left;">Version control...</h3>
    <img src="pics/comic_box5.svg" alt="">
</section>


<section style="text-align: left;">
    <h3>...Version control</h3>
    Let's add some Markdown text to a README file in the dataset
    <pre style="margin-left: 0;">
        <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
            echo "# A BIDS structured dataset for my input data" > README.md
        </code>
    </pre>

    <div class="fragment">
        Now we can check the <code>status</code> of the dataset:
        <pre style="margin-left: 0;">
            <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                datalad status
            </code>
        </pre>
    </div>

    <div class="fragment">
        We can save the state with <code>save</code>
        <pre style="margin-left: 0;">
            <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                datalad save -m "Add a short README"
            </code>
        </pre>
    </div>

    <div class="fragment">
        Further modifications:
        <pre style="margin-left: 0;">
            <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                echo "Contains functional task data of one subject" >> README.md
            </code>
        </pre>
    </div>

    <div class="fragment">
        Save again:
        <pre style="margin-left: 0;">
            <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                datalad save -m "Add information on the dataset contents to the README"
            </code>
        </pre>
    </div>

    <div class="fragment">
        Now, let's check the dataset history:
        <pre style="margin-left: 0;">
            <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                git log
            </code>
        </pre>
    </div>
</section>


<section>
    <h3 style="text-align: left;">Data consumption & transport...</h3>
    <img src="pics/comic_box6_consumption.svg" alt="">
</section>


<section style="text-align: left;">
    <h3>...Data consumption & transport...</h3>

    Install a dataset from remote URL (or local path) using <code>clone</code>:
    <pre style="margin-left: 0;">
        <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
            cd ../
            datalad clone \
            https://github.com/psychoinformatics-de/studyforrest-data-phase2.git
        </code>
    </pre>
    <div class="fragment">
        We can now view the cloned dataset's file tree:
        <pre style="margin-left: 0;">
            <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                cd studyforrest-data-phase2
                ls
            </code>
        </pre>
    </div>

    <div class="fragment">
        Let's check the dataset size (i.e. git repository):
        <pre style="margin-left: 0;">
            <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                du -sh # this will print the size of the directory in human readable sizes
            </code>
        </pre>
    </div>

    <div class="fragment">
        Let's check the <em>actual</em> dataset size (i.e. git repository + annexed content):
        <pre style="margin-left: 0;">
            <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                datalad status --annex
            </code>
        </pre>
    </div>

    <div class="fragment">
        The DataLad dataset is just the git repository,
        i.e. the metadata of all files in the dataset,
        including the content of all files comitted to git.
        The actual file content in the annex can be retrieved as needed.
    </div>
</section>


<section style="text-align: left;">
    <h3>...Data consumption & transport</h3>

    We can retrieve actual file content with <code>get</code> (here, multiple files):
    <pre style="margin-left: 0;">
        <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
            # get all files of sub-01 for all functional runs of the localizer task
            datalad get \
            sub-01/ses-localizer/func/sub-01_ses-localizer_task-objectcategories_run-*.nii.gz
        </code>
    </pre>

    <div class="fragment">
        If we don't need a file locally anymore, we can <code>drop</code> it:
        <pre style="margin-left: 0;">
            <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                # drop a specific file
                datalad drop \
                sub-01/ses-localizer/func/sub-01_ses-localizer_task-objectcategories_run-4_bold.nii.gz
            </code>
        </pre>
    </div>

    <div class="fragment">
        And it's no problem if you need that exact file again, just <code>get</code>it:
        <pre style="margin-left: 0;">
            <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                # get a specific file
                datalad drop \
                sub-01/ses-localizer/func/sub-01_ses-localizer_task-objectcategories_run-4_bold.nii.gz
            </code>
        </pre>
    </div>

    <div class="fragment">
        Therefore: no need to store all files locally.
        Data just needs to be available from at least one location,
        then you can <code>get</code> what you want when you need it,
        and <code>drop</code> the rest.
    </div>
</section>


<section style="text-align: left;">
    <h3>Dataset nesting...</h3>

    Datasets can be nested in superdataset-subdataset hierarchies:

    <img src="pics/linkage_subds.png" alt="">
    
    <ul class="fragment">
        <li>Helps with scaling (see e.g. the <a href="https://github.com/datalad-datasets/human-connectome-project-openaccess">Human Connectome Project dataset</a> )</li>
        <li>Version control tools struggle with >100k files</li>
        <li>Modular units improves intuitive structure and reuse potential</li>
        <li>Versioned linkage of inputs for reproducibility</li>
    </ul>
</section>


<section style="text-align: left;">
    <h3>...Dataset nesting</h3>

    Let's make a nest! First we navigate into the top-level dataset:
    <pre style="margin-left: 0;">
        <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
            cd ../bids-data
        </code>
    </pre>

    <div class="fragment">
        Then we clone the input dataset into a specific location in the file tree of the existing dataset, making it a <em>sub</em>dataset (using the <code>-d/--dataset</code> flag):
        <pre style="margin-left: 0;">
            <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                datalad clone --dataset . \
                https://github.com/datalad/example-dicom-functional.git  \
                inputs/rawdata
            </code>
        </pre>
    </div>

    <div class="fragment">
        Similarly, we can clone the analysis container (actually, a set of containers from <a href="https://www.repronim.org/">ReproNim</a>) as a subdataset:
        <pre style="margin-left: 0;">
            <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                datalad clone -d . \
                https://github.com/ReproNim/containers.git \
                code/containers
            </code>
        </pre>
    </div>

    <div class="fragment">
        Let's see what changed in the dataset, using the <code>subdatasets</code> command:
        <pre style="margin-left: 0;">
            <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                datalad subdatasets
            </code>
        </pre>
    </div>
</section>


<section>
    <h3 style="text-align: left;">Computationally reproducible execution...</h3>
    <img src="pics/comic_box7.svg" width="65%" alt="">
    <ul>
        <li class="fragment fade-in-then-semi-out">which script/pipeline version</li>
        <li class="fragment fade-in-then-semi-out">was run on which version of the data</li>
        <li class="fragment fade-in-then-semi-out">to produce which version of the results?</li>
    </ul>
</section>

<section style="text-align: left;">
    <h3>...Computationally reproducible execution...</h3>

    <ul>
        <li class="fragment fade-in-then-semi-out">The <code>datalad run</code> can run any command in a way that links the command or script to the results it produces and the data it was computed from</li>
        <li class="fragment fade-in-then-semi-out">The <code>datalad rerun</code> can take this recorded provenance and recompute the command</li>
        <li class="fragment fade-in-then-semi-out">The <code>datalad containers-run</code> (from the extension) can capture software provenance in the form of software containers in addition to the provenance that datalad run captures</li>
    </ul>
    <br><br>

    <div class="fragment">
        With the <code>datalad-container</code> extension, we can inspect the list of registered containers (recursively):
        <pre style="margin-left: 0;">
            <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                datalad containers-list --recursive
            </code>
        </pre>
    </div>

    <div class="fragment">
        We'll use the <code>repronim-reproin</code> container for dicom conversion.
    </div>

</section>


<section style="text-align: left;">
    <h3>...Computationally reproducible execution</h3>

    Now, let's try out the <code>containers-run</code> command:
    <pre style="margin-left: 0;">
        <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
            datalad containers-run -m "Convert subject 02 to BIDS" \
            --container-name code/containers/repronim-reproin \
            --input inputs/rawdata/dicoms \
            --output sub-02 \
            "-f reproin -s 02 --bids -l '' --minmeta -o . --files inputs/rawdata/dicoms"
        </code>
    </pre>
    <div class="fragment">
        What changed after the <code>containers-run</code> command has completed?
        <br>
        We can use <code>datalad diff</code> (based on <code>git diff</code>):
        <pre style="margin-left: 0;">
            <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                datalad diff -f HEAD~1
            </code>
        </pre>    
    </div>

    <div class="fragment">
        We see that some files were added to the dataset!
        <br>
        And we have a complete provenance record as part of the git history:
        <pre style="margin-left: 0;">
            <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                git log -n 1
            </code>
        </pre>
    </div>
</section>


<section>
    <h3 style="text-align: left;">Publishing datasets...</h3>
    <div style="margin-top:1em;">
        <table style="border: none;">
            <tr>
                <td><img style="width: 800px; margin-right:1px;margin-bottom:10px;vertical-align:middle;" data-src="pics/comic_box6_publishing.svg" /></td>
                <td><img style="width: 1000px; margin-right:1px;margin-bottom:10px;vertical-align:middle;" data-src="pics/comic_box9.svg" /></td>
            </tr>
        </table>
    </div>
    <br>
    <div class="fragment">We will use GIN: <a href="https://gin.g-node.org/">gin.g-node.org</a>:</div>
    <br>
    <ol>
        <li class="fragment">Create a GIN user account and log in</li>
        <li class="fragment"><a href="https://docs.github.com/en/authentication/connecting-to-github-with-ssh/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent?platform=linux">Create</a> and <a href="https://handbook.datalad.org/en/latest/basics/101-139-gin.html#prerequisites">upload</a> an SSH key to GIN</li>
        <li class="fragment">Create a new <em><strong>empty</strong></em> repository named "bids-data" and copy it's SSH URL</li>
    </ol>
</section>


<section style="text-align: left;">
    <h3>...Publishing datasets</h3>

    DataLad allows you to add repositories as <code>siblings</code> to a dataset, to which data can be published with <code>push</code>.
    <pre style="margin-left: 0;">
        <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
            datalad siblings add -d . \
            --name gin \
            --url git@gin.g-node.org:/your-gin-username/bids-data.git
        </code>
    </pre>

    <div class="fragment">
        You can verify the dataset's siblings with the <code>siblings</code> command:
        <pre style="margin-left: 0;">
            <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                datalad siblings
            </code>
        </pre>
    </div>

    <div class="fragment">
        And we can push our complete dataset (git repository and annex) to GIN:
        <pre style="margin-left: 0;">
            <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                datalad push --to gin
            </code>
        </pre>
    </div>
</section>


<section style="text-align: left;">
    <h3>Using published data...</h3>

    Let's use our published data in a new analysis, to demonstrate reusability and the usefulness of modularity.
    <br><br>
    First let's create a new dataset using the <a href="https://handbook.datalad.org/en/latest/basics/101-127-yoda.html#yoda">yoda principles</a>:
    <pre style="margin-left: 0;">
        <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
            cd ../
            datalad create -c yoda myanalysis
        </code>
    </pre>

    <div class="fragment">
        Then we can clone our GIN-published dataset as a subdataset <br>
        (<strong>NB:</strong> use the browser URL without ".git" suffix):
        <pre style="margin-left: 0;">
            <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                cd myanalysis
                datalad clone -d . \
                https://gin.g-node.org/your-gin-username/bids-data \
                input
            </code>
        </pre>
    </div>
</section>


<section style="text-align: left;">
    <h3>...Using published data...</h3>

    We have data, and now we need an analysis script.
    We will use DataLad's <code>download-url</code> which gets the content of a script and registers its source:
    <pre style="margin-left: 0;">
        <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
            datalad download-url -m "Download code for brain masking from Github" \
            -O code/get_brainmask.py \
            https://raw.githubusercontent.com/datalad-handbook/resources/master/get_brainmask.py
        </code>
    </pre>

    <div class="fragment">
        Now we have data and an analysis script, and we still need the correct software environment within which the run the analysis.
        We will again use the <code>datalad-container</code> extension to register a container to the new dataset:
        <pre style="margin-left: 0;">
            <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                datalad containers-add nilearn \
                --url shub://adswa/nilearn-container:latest \
                --call-fmt "singularity exec {img} {cmd}"
            </code>
        </pre>
    </div>
</section>


<section style="text-align: left;">
    <h3>...Using published data</h3>

    Finally, we can run the analysis:
    <pre style="margin-left: 0;">
        <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
            datalad containers-run -m "Compute brain mask" \
            -n nilearn \
            --input input/sub-02/func/sub-02_task-oneback_run-01_bold.nii.gz \
            --output figures/ \
            --output "sub-02*" \
            "python code/get_brainmask.py"
        </code>
    </pre>

    <div class="fragment">
        Afterwards, we can inspect how specific files came to be, e.g.:
        <pre style="margin-left: 0;">
            <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                git log sub-02_brain-mask.nii.gz
            </code>
        </pre>
    </div>

    <div class="fragment">
        And since the run-record is part of the dataset's git history, we know the provenance.
        DataLad can use this machine-readable information to <em>rerun</em> the analysis without you having to specify any information again:
        <pre style="margin-left: 0;">
            <code data-trim class="language-bash" onmousemove="showHover(event)" onmousedown="clickCopy(event)" onmouseleave="leaveElement(event)">
                datalad rerun
            </code>
        </pre>
    </div>
</section>



<!-- 

<section>
    <h2>2. DataLad: an overview</h2>
    <img src="pics/comic_box8.svg" alt="">
</section>

<section>
    <h2>2. DataLad: an overview</h2>
    <img src="pics/comic_box9.svg" alt="">
</section>

<section>
    <h2>2. DataLad: an overview</h2>
    <img src="pics/comic_box10.svg" alt="">
</section> -->




</div> <!-- /.slides -->
</div> <!-- /.reveal -->

<script src="reveal.js/dist/reveal.js"></script>
<script src="reveal.js/plugin/notes/notes.js"></script>
<script src="reveal.js/plugin/markdown/markdown.js"></script>
<script src="reveal.js/plugin/highlight/highlight.js"></script>
<script src="custom_functions.js"></script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js"></script>
<script src="reveal.js/plugin/copycode/copycode.js"></script> -->
<script>
    // More info about initialization & config:
    // - https://revealjs.com/initialization/
    // - https://revealjs.com/config/
    Reveal.initialize({
        hash: true,
        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1280,
        height: 960,
        // Factor of the display size that should remain empty around the content
        margin: 0.02,
        // Bounds for smallest/largest possible scale to apply to content
        minScale: 0.2,
        maxScale: 1.0,

        controls: true,
        progress: true,
        history: true,
        center: false,
        slideNumber: 'c',
        pdfSeparateFragments: false,
        pdfMaxPagesPerSlide: 1,
        pdfPageHeightOffset: -1,
        transition: 'slide', // none/fade/slide/convex/concave/zoom
        // Learn about plugins: https://revealjs.com/plugins/
        plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ]
    });
</script>
</body>
</html>